{
  "version": 4,
  "terraform_version": "1.1.7",
  "serial": 388,
  "lineage": "cc947e9f-2320-e2f3-c36d-1c500852e7cc",
  "outputs": {
    "learn_password": {
      "value": "qu2ZMKSne99uImEEKsq8",
      "type": "string",
      "sensitive": true
    },
    "learn_rg": {
      "value": "ncd-39-student-aa3@SA5k",
      "type": "string"
    },
    "learn_user": {
      "value": "student-aa3@sa5k",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "external",
      "name": "user",
      "provider": "provider[\"registry.terraform.io/hashicorp/external\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "-",
            "program": [
              "/usr/bin/bash",
              "user_data_provider.sh"
            ],
            "query": {
              "bearer": "04ffede6415eb4f6bd9b24648e4dba2761b55d5e",
              "endpoint": "https://cloud.nsalab.org",
              "login": "student-aa3@SA5k"
            },
            "result": {
              "id": "d6cc9d59-9286-4be2-8ff0-0b0e133d25b1",
              "login": "student-aa3@sa5k",
              "member_id": "4ce6d07b-bf8f-4394-905e-3fd595a4b429",
              "password": "qu2ZMKSne99uImEEKsq8"
            },
            "working_dir": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_firewall_template",
      "name": "allow_all_ingress",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "egress_rule": [],
            "id": "f1f4d56b-03e6-4ca9-9212-1ebbfc0b88fc",
            "ingress_rule": [
              {
                "destination_ip": "",
                "id": "092f6bd1-5441-4701-b890-b0a62b08cdb9",
                "name": "Allow all ingress",
                "port_range": "",
                "protocol": "any"
              }
            ],
            "name": "Разрешить входящий трафик",
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_firewall_template",
      "name": "allow_default",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "egress_rule": [
              {
                "destination_ip": "",
                "id": "e6ce8bd1-2b3e-49ef-ab21-553d80fb7ba5",
                "name": "Allow all egress",
                "port_range": "",
                "protocol": "any"
              }
            ],
            "id": "00000000-0000-0000-0000-000000000000",
            "ingress_rule": [],
            "name": "По-умолчанию",
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_hypervisor",
      "name": "kvm",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "60f7614a-f1ee-44c6-b6ee-5790706c649a",
            "name": "KVM",
            "project_id": "",
            "type": "kvm"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_network",
      "name": "service_network",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "4ffbc1e1-a187-49b2-9b5d-e9f3c5302f2b",
            "name": "Сеть",
            "subnets": [
              {
                "cidr": "10.0.1.0/24",
                "dhcp": true,
                "dns": [
                  "8.8.8.8",
                  "8.8.4.4"
                ],
                "end_ip": "10.0.1.254",
                "gateway": "10.0.1.1",
                "id": "e416e4be-2d07-4fdd-b07d-91101c3b3998",
                "start_ip": "10.0.1.2"
              }
            ],
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_storage_profile",
      "name": "ssd",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "053609af-176f-4d6d-84c9-3da49bf3b420",
            "name": "SSD",
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "data",
      "type": "rustack_template",
      "name": "ubuntu16",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "9bb515c5-bcd3-4cb1-a3b9-0f64db9f21bd",
            "min_cpu": 1,
            "min_disk": 10,
            "min_ram": 1,
            "name": "Ubuntu 16.04",
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "null_resource",
      "name": "user_provisioner",
      "provider": "provider[\"registry.terraform.io/hashicorp/null\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "6048717324476576329",
            "triggers": null
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.learn",
            "rustack_project.project"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_string",
      "name": "learn",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "id": "aa3@SA5k",
            "keepers": null,
            "length": 8,
            "lower": true,
            "min_lower": 2,
            "min_numeric": 2,
            "min_special": 1,
            "min_upper": 2,
            "number": true,
            "override_special": "@",
            "result": "aa3@SA5k",
            "special": false,
            "upper": true
          },
          "sensitive_attributes": [],
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "rustack_project",
      "name": "project",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "d974d2fe-5b0d-4445-b71a-3eaf4022c67e",
            "name": "ncd-39-student-aa3@SA5k"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "random_string.learn"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "rustack_router",
      "name": "default_router",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "floating": true,
            "floating_id": "3101893a-6b49-4443-a7ad-c1f55f5b64ef",
            "id": "907acfa7-9a38-479e-9f5a-79c7f16da31a",
            "is_default": false,
            "name": "Роутер",
            "networks": [
              "4ffbc1e1-a187-49b2-9b5d-e9f3c5302f2b"
            ],
            "system": true,
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": [],
          "private": "bnVsbA==",
          "dependencies": [
            "data.rustack_hypervisor.kvm",
            "data.rustack_network.service_network",
            "random_string.learn",
            "rustack_project.project",
            "rustack_vdc.vdc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "rustack_vdc",
      "name": "vdc",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "hypervisor_id": "60f7614a-f1ee-44c6-b6ee-5790706c649a",
            "id": "d1abc855-e45c-4385-a5be-afe3fc936bb6",
            "name": "VDC-aa3@SA5k",
            "project_id": "d974d2fe-5b0d-4445-b71a-3eaf4022c67e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.rustack_hypervisor.kvm",
            "random_string.learn",
            "rustack_project.project"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "rustack_vm",
      "name": "ubuntu16",
      "provider": "provider[\"registry.terraform.io/pilat/rustack\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cpu": 1,
            "disks": null,
            "floating": true,
            "floating_ip": "88.214.35.124",
            "id": "54544006-4b50-41ce-84b0-2fce1571b57d",
            "name": "EVE-NG",
            "port": [
              {
                "firewall_templates": [
                  "00000000-0000-0000-0000-000000000000",
                  "f1f4d56b-03e6-4ca9-9212-1ebbfc0b88fc"
                ],
                "id": "bd1296a3-a69d-4ee5-80b9-79779453dedd",
                "ip_address": "10.0.1.5",
                "network_id": "4ffbc1e1-a187-49b2-9b5d-e9f3c5302f2b"
              }
            ],
            "ram": 1,
            "system_disk": [
              {
                "id": "4eb8ccb6-0dc9-4f5f-881f-482272687bb3",
                "name": "Основной диск",
                "size": 10,
                "storage_profile_id": "053609af-176f-4d6d-84c9-3da49bf3b420"
              }
            ],
            "template_id": "9bb515c5-bcd3-4cb1-a3b9-0f64db9f21bd",
            "timeouts": null,
            "user_data": "#cloud-config\ndebug:\n  verbose: true\ncloud_init_modules:\n - migrator\n - seed_random\n - write-files\n - growpart\n - resizefs\n - set_hostname\n - update_hostname\n - update_etc_hosts\n - users-groups\n - ssh\n - runcmd\n - write_files\nchpasswd:\n  list: |\n    root:VeryLongP@ssw0rd\n  expire: false\nwrite_files:\n- path: /opt/ovf/ovfconfig.sh\n  content: |\n    #!/bin/bash\n\n    # Check if VM is alredy configured\n    if [[ -e /opt/ovf/.configured ]]; then\n        exit\n    fi\n\n    . ~/.profile\n\n    # Setting Management Network\n    cat \u003e /etc/network/interfaces \u003c\u003c EOF\n    # This file describes the network interfaces available on your system\n    # and how to activate them. For more information, see interfaces(5).\n\n    # The loopback network interface\n    auto lo\n    iface lo inet loopback\n\n    # The primary network interface\n    iface eth0 inet manual\n\n    auto pnet0\n    iface pnet0 inet dhcp\n      bridge_ports eth0\n      bridge_stp off\n      dns-nameservers 8.8.8.8 8.8.4.4\n    EOF\n\n    service networking restart\n\n    # Setting the NTP server\n    sed -i 's/NTPDATE_USE_NTP_CONF=.*/NTPDATE_USE_NTP_CONF=yes/g' /etc/default/ntpdate\n    sed -i 's/NTPSERVERS=.*/NTPSERVERS=/g' /etc/default/ntpdate\n\n    # Cleaning\n    rm -rf /root/.bash_history /opt/unetlab/tmp/* /tmp/netio* /tmp/vmware* /opt/ovf/ovf_vars /opt/ovf/ovf.xml /root/.bash_history /root/.cache\n    find /var/log -type f -exec rm -f {} \\;\n    find /var/lib/apt/lists -type f -exec rm -f {} \\;\n    find /opt/unetlab/data/Logs -type f -exec rm -f {} \\;\n    touch /var/log/wtmp\n    chown root:utmp /var/log/wtmp\n    chmod 664 /var/log/wtmp\n\n    touch /opt/ovf/.configured\n  owner: root:root\n  permissions: '0644'\n- path: /opt/deploy.sh\n  content: |\n    #!/bin/bash\n    \n    bash /opt/install-eve.sh \n    #rm -f /opt/install-eve.sh\n\n    bash /opt/get-images.sh\n    #rm /opt/get-images.sh\n\n    bash /opt/eve-bootstrap.sh\n    #rm /opt/eve-bootstrap.sh\n\n    bash /opt/ovf/ovfconfig.sh\n    #rm /opt/ovf/ovfconfig.sh\n  owner: root:root\n  permissions: '0644'\n- path: /opt/eve-bootstrap.sh\n  content: |\n    #!/bin/bash\n    \n    #Login as admin\n    curl -s -b /tmp/cookie -c /tmp/cookie -X POST -d '{\"username\":\"admin\",\"password\":\"eve\"}' http://127.0.0.1/api/auth/login\n\n    #Change admin password\n    curl -s -c /tmp/cookie -b /tmp/cookie -X PUT -d '{\"name\":\"admin\",\"email\":\"root@localhost\",\"password\":\"qu2ZMKSne99uImEEKsq8\",\"role\":\"admin\",\"expiration\":\"-1\",\"pod\":0,\"pexpiration\":\"-1\"}' -H 'Content-type: application/json' http://127.0.0.1/api/users/admin\n  owner: root:root\n  permissions: '0644'\n- path: /opt/get-images.sh\n  content: |\n    #!/bin/bash\n\n    apt-get -y update\n    apt-get -y install awscli\n    aws configure set region \"EU\" --profile default\n    aws configure set aws_access_key_id MMX8Y3VVBBTXEKB42Q9D --profile default\n    aws configure set aws_secret_access_key yAQkZ3HbnMAu9ExUA9SkI6HbNy6gFFZj6UW0IgKY --profile default\n    mkdir -p /opt/unetlab/addons/qemu\n    aws s3 sync --endpoint-url https://s3.sbcloud.online s3://qc2022-images /opt/unetlab/addons/qemu/\n    \n  owner: root:root\n  permissions: '0644'\nruncmd:\n- sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/g' /etc/ssh/sshd_config\n- service sshd restart\n- bash /opt/deploy.sh \u003e\u003e /opt/deploy.log",
            "vdc_id": "d1abc855-e45c-4385-a5be-afe3fc936bb6"
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.external.user",
            "data.rustack_firewall_template.allow_all_ingress",
            "data.rustack_firewall_template.allow_default",
            "data.rustack_network.service_network",
            "data.rustack_storage_profile.ssd",
            "data.rustack_template.ubuntu16",
            "rustack_router.default_router",
            "rustack_vdc.vdc"
          ]
        }
      ]
    }
  ]
}
