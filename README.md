# Поиск и устранение неисправностей в информационной инфраструктуре

*Конкурсное задание отборочного чемпионата Молодые профессионалы по компетенции "Сетевое и системное администрирование"*

## Об инфраструктуре

Добрый день! Вас приветствует бывший системный администратор небольшой компании TSHOOT. Если Вы нашли это письмо, значит ноги моей в этой забытой всеми демонами ада конторе больше нет - и хорошо! Давайте я познакомлю Вас с будущим подшефным хозяйством, и помните - никогда не поздно уйти работать в другое место! 

Основная мысль, овладевшая больным воображением менеджмента этого филиала Ада - отказоустойчивость! Общая архитектура этого решения такова:

- STR - надежная ВМ, выполняющая функцию хранилища. Используется как мастер-сервер DNS и хранилка данных прочих решений. Её надежность обусловлена внешними факторами и Вам о ней беспокоиться не нужно. (Не обращайте внимания на капли красного цвета в серверной, перья и малопонятные письмена - весьма специфический подрядчик был, конечно);
- SRV-1 и SRV-2 - наши “боевые” ВМ, созданы умирать и рождаться снова. На них развернуты службы времени, журналирования, DNS и DHCP. Так же здесь хостится наш рабочий сайт site.tshoot.os и балансировщики для этого и прочих сайтов. 
- В компании есть и другие  компоненты инфраструктуры
- AD - Наш старый доменный контроллер, на нем и функций почти не осталось. Так, авторизация на клиентах да поддомен держим там. Скоро совсем до свидания;
- CON-1 и CON-2 - это ВМ для хостинга контейнеров - очень изучаем это дело, пытаемся делать нормально. В отличие от SRV-сети тут даже сделали файрволл, чтобы кто попало не шастал - на SRV если включить файеры то развалится все с таким грохотом, что и рисковать не хотелось. 
- Клиенты - нынче там живет одинокий CLI-L, но в целом обслуживание клиентов ведется у нас здесь. Интеграция в домен, DHCP раздает адреса - все как у людей; 
- CLI-A - отдельная администраторская подсеть. Адреса статические, интеграция с доменом - оттуда мы диктуем нашу непреклонную волю всей компании, по возможности не привлекая внимания начальства;
- Выход в интернеты через ВМ FW - ничего необычного. Прочие маршрутизаторы заняты маршрутизированием.
-CLI-R - наш внешний клиент, единственная задача - прицепить его как-то в нашу инфраструктуру, чтобы мог по сайтику рабочему ходить. Тоже без магии. 

Логины и пароли:
- Administrator@domain.tshoot.os : Pa$$w0rd
- user@domain.tshoot.os : Pa$$w0rd
- operator@domain.tshoot.os : Pa$$w0rd
- user : user
- root : toor
- vyos : vyos
- ansible : ansible 


## О проверке
В ходе проверке будет использоваться сценарий автоматизации на основе Ansible. В качестве хоста управления выступает ВМ CHECKER. Пользователь управления - ansible:ansible. В домашнем каталоге данного пользователя сформирована вся необходимая среда для запуска сценариев проверки. С точки зрения участника важно принять во внимание следующее:

- Перед сдачей стенда убедитесь, что управление с хоста CHECKER всеми описанными в inventory ВМ выполняется успешно. Это можно выполнить с помощью команды ansible -m ping all;
- ВМ должны сохранять используемые IP-адреса, либо оставаться в пределах заданных в DHCP-сервере диапазонах адресов;
- Логины и пароли должны оставаться без изменений;
- Все ВМ должны быть включены при сдаче стенда;
- Содержимое веб-страниц должно оставаться в рамках заданных шаблонов


## Тикет №1

Добрый день, Оператор беспокоит!  У меня в домашнем каталоге на CLI-A есть скрипт добавления DNS-записей в систему, я собрал его по инструкции в Интернете - и не работает. Может быть, я ошибся, может быть, наша система DNS не настроена корректно - не знаю. Мне нужна эта штука для ковыряния контейнерных вещей - удобнее, когда добавлять можно самому. Инструкция простая:
``` ./add_dns.sh  <Имя>  <Адрес> ```

## Тикет №2 
Добрый день, с журналами беда. Делали отказоустойчиво, с внешней хранилкой - логи то сыпятся, но вот незадача - не все. Для серверов SRV-1/2  - один файл, для роутеров и брандмауэра - другой, ну а контейнеровозы(хе-хе) должны засылать все в третий. Безопасник пробурчал, что “не хватает”, прошу разобраться. У него программка их автоматом забирает с STR, думаю, это важно. 

## Тикет №3
Добрый день. Однажды (условия возникновения особо не известны)  у нас возникали проблемы с с сертификатами. Кратко - они некоторое время на некоторых ВМ признавались некорректными, точная причина, увы, утеряна. Тогда было решено списать это на сбой - тогда много чего сбоило - но все таки лучше узнать, что же произошло. 

## Тикет №4
Добрый день, снова журналы. Безопасник пытался установить причину сбоя и утверждает, что ничего не нашел. В смысле, никаких записей. Это как-то странно - у нас все таки отказоустойчивое логирование именно для этих целей делалось. Надо расследовать. 

## Тикет №5
Приветствую, возникла такая ситуация. Два наших служащих утверждают, что на рабочем сайте была разная инструкция, поэтому они не смогли согласовать свои действия. Действительно, в контент сайта вносились изменения (и все должны были их видеть), но, видимо, часть пользователей продолжала получать старую страницу. Прошу установить причину, пока все изменения откатили. 

## Тикет №6
Салют, I guess. Пользователь на связи. Я пытался играться с этими докерами\жокерами на CON-1, поднял вроде бы NGINX с вроде бы страничкой, которая вроде бы должна работать (все делал по инструкции в интернете, соль по вкусу, варить до готовности). В CON-1/2 просто так ничего развертывать нельзя, но мне добавили порт-исключение. Со своего ПК CLI-A проверил разок перед уходом - не работает. Сейчас на больничном сижу, но просьба дочинить - потом на основе этого опыта будем перетаскивать наши сайтики, прогресс, молодость, успех, сертификация. 

## Тикет №7
Добрый день. Подключаем CLI-R, ничего серьезного - простой вайргард, лишь бы связность с узлами сети была. Ну что, инструкция из интернета, немного смелости - и ничего не работает. Просьба починить, но не меняйте адреса! Они такие вот уже прописаны в нужном месте.  

## Тикет №8
Приветствую, Оператор на связи. В рамках миграции на эти контейнеры и прочие ансибли (не сидится кому-то спокойно) решил я значит осилить эту муть, все равно придется. У меня в домашнем каталоге есть плейбук, который собирает образ веб-сервера с тестовой страницей(свое имя показывает, ну и стандартное приветствие), вешает его прослушивать указанный порт  ну и накидывает прочее - DNS-имя, балансировщик, порты открывает и так далее. 
Так вот - не работает :) Поможешь? Запускается с параметрами ``in_port`` и ``In_name``. 

## Тикет №9
Добрый день, во время сбоя часть клиентов теряла связность с некоторыми сервисами компании (пользователи затруднились пояснить, что конкретно было недоступно, цитирую “ваще ниче не работало(((“,  другой информации нет). Прошу разобраться - отказоустойчивость должна быть отказоустойчивой! 
